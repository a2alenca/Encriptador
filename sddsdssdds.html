<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inventario Lotus Flower</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    th { background-color: #eee; }
    input[type="number"], input[type="text"], input[type="date"] { width: 100%; padding: 5px; }
    select { padding: 5px; width: 100%; }
    button {
      padding: 10px 15px;
      background: #25D366;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 10px;
    }
    h3 { margin-top: 40px; background: #ddd; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>

  <h2>Inventario Lotus Flower</h2>

  <label><strong>Responsable del Inventario:</strong></label><br>
  <input type="text" id="responsable" placeholder="Nombre responsable" required><br><br>

  <label><strong>Fecha del Inventario:</strong></label><br>
  <input type="date" id="fecha" required><br><br>

  <form id="formularioInventario">
    <div id="contenedorZonas"></div>

    <button type="button" onclick="enviarWhatsApp()">Enviar WhatsApp</button>
    <button type="button" onclick="generarExcel()">Descargar Excel</button>
  </form>

  <script>
    const zonas = {
      "1. Abarrotes": [
        "AZUCAR BLANCA", "AZUCAR ESTEVIA", "AZUCAR FLOR", "AZUCAR SACKET", "CAPSULAS NESPRESSO", "CREMA DE LECHE", "ENDULZANTE LIQUIDO", "LECHE DE COCO", "NESCAFE SACKET", "TE"
      ],
      "2. Artículos de Aseo": [
        "BOLSA DE BASURA 70X90", "CAJA DE GUANTES", "CLORO", "ESCOBA", "ESPONJA", "JABON MANO", "LAVALOZA", "LIMPIA PISO", "LIMPIA VIDRIO", "PALA", "PAÑO MICROFIBRA", "TOALLA NOVA", "TRAPEROS"
      ],
      "3. Bajativos": [
        "AMARETTO 645ML", "AMARETTO MITJANS 750ML", "BITTER ARAUCANO 900ML", "CHERRY 645ML", "FERNET 645ML", "FERNET MITJANS 750ML", "MANZANILLA 645ML", "MANZANILLA MITJANS 750ML", "MENTA 645ML", "MENTA DUVAL 1LT"
      ],
      "4. Bebidas": [
        "BILZ", "COCA COLA", "COCA ZERO", "FANTA", "GINGER ALE", "GINGER LIGHT", "KEM PIÑA", "LIMON SODA", "MINERAL CON GAS", "MINERAL SIN GAS", "SPRITE", "SPRITE ZERO", "TONICA"
      ],
      "5. Cervezas": [
        "AUSTRAL CALAFATE", "AUSTRAL LAGER", "AUSTRAL PALE ALE", "CORONA", "GINGER BEER", "HEINEKEN", "HEINEKEN CERO", "KROSS", "ROYAL", "TOROBAYO"
      ],
      "6. Destilados": [
        "APEROL 750ML", "CACAO MITJNS 750ML", "CACHAZA 51 965ML", "CAMPARI 750ML", "COÑAC TRES PALOS 1LTS", "CURAZAO BLUE 750ML", "GIN BEEFEATER 750ML", "GIN BOMBAY 750ML", "GIN TANQUERY 700ML", "JAGERMEISTER 700ML",
        "MARTINI VERMONT EXTRA DRY", "MARTINI VERMONT ROSSO", "MARTINI VERMOUTH BLANCO", "PISCO ALTO DEL CARMEN 35°", "PISCO ALTO DEL CARMEN 40°", "PISCO CAPEL 35° 1LT", "PISCO MISTRAL NOBEL AÑEJADO 40", "PISCO TABERNERO 2LTS",
        "RAMAZZOTTI 700ML", "RON BACARDI", "RON MALIBU 750ML", "RON VARADERO 750ML", "TEQUILA OLMECA 700ML", "TEQUILA SOMBRERO NEGRO 750ML", "TRIPLE SEC 750ML", "VINO AÑEJO CENTENARIO 1LTS", "VODKA ABSOLUT 750ML",
        "VODKA ERISTOFF 750ML", "VODKA STOLICHNAYA 750ML", "WHISKY CHIVAS 12 AÑOS", "WHISKY GLENFIDDICH 12 AÑOS", "WHISKY JACK DANIELS", "WHISKY JACK DANIELS HONEY", "WHISKY JOHNNIE WALKER NEGRO", "WHISKY JOHNNIE WALKER ROJO", "WHISKY TULLAMORE 750ML"
      ],
      "7. Espumantes": ["ESPUMANTE PARA TRAGOS", "VALDIVIESO BRUT", "VALDIVIESO SEMI BRUT"],
      "8. Pulpa Jugos": ["CHIRIMOYA", "FRAMBUESA", "MANGO", "MARACUYA", "PIÑA"],
      "9. Vino - Cabernet Sauvignon": [
        "LAS MULAS 750ML", "MEDALLA REAL 750ML", "SANTA DIGNA 375ML", "SANTA DIGNA 750ML", "SANTA DIGNA BOTELLIN 187ML", "SANTA EMA RSVA 375ML", "VINO TERRAANDINA 750ML"
      ],
      "10. Vino - Carmenere": [
        "CARMEN FRIDA KAHLO", "LAS MULAS 750ML", "SANTA DIGNA 375ML", "SANTA DIGNA 750ML", "SANTA DIGNA BOTELLIN 187ML", "SANTA EMA RSVA 375ML"
      ],
      "11. Vino - Chardonnay": ["LAS MULAS 750ML", "SANTA DIGNA 750ML", "SANTA EMA RSVA 750ML"],
      "12. Vino - Merlot": ["LAS MULAS 750ML", "MEDALLA REAL GRAN RSVA", "SANTA EMA RSVA 750ML", "SANTA DIGNA 750ML"],
      "13. Vino - Sauvignon Blanc": ["LAS MULAS 750ML", "SANTA DIGNA 375ML", "SANTA DIGNA 750ML", "SANTA DIGNA BOTELLIN 187ML", "SANTA EMA RSVA 375ML"]
    };

    function crearTabla(zona, productos) {
      const contenedor = document.getElementById("contenedorZonas");

      const encabezado = document.createElement("h3");
      encabezado.textContent = zona;
      contenedor.appendChild(encabezado);

      const tabla = document.createElement("table");
      const thead = document.createElement("thead");
      thead.innerHTML = `
        <tr>
          <th>Producto</th>
          <th>Unidades por caja</th>
          <th>Unidades sueltas</th>
          <th>Total unidades</th>
        </tr>
      `;
      tabla.appendChild(thead);

      const tbody = document.createElement("tbody");
      productos.forEach(producto => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
          <td>${producto}</td>
          <td><input type="number" class="cajas" min="0" data-producto="${producto}" value="0"></td>
          <td><input type="number" class="sueltas" min="0" data-producto="${producto}" value="0"></td>
          <td><input type="number" class="total" readonly></td>
        `;
        tbody.appendChild(fila);
      });
      tabla.appendChild(tbody);
      contenedor.appendChild(tabla);
    }

    function actualizarTotales() {
      document.querySelectorAll("tr").forEach(fila => {
        const cajas = fila.querySelector(".cajas");
        const sueltas = fila.querySelector(".sueltas");
        const total = fila.querySelector(".total");

        if (cajas && sueltas && total) {
          const suma = parseInt(cajas.value || 0) + parseInt(sueltas.value || 0);
          total.value = suma;
        }
      });
    }

    function obtenerDatos() {
      const datos = [];
      document.querySelectorAll("tbody tr").forEach(fila => {
        const producto = fila.children[0].textContent;
        const cajas = fila.querySelector(".cajas").value;
        const sueltas = fila.querySelector(".sueltas").value;
        const total = fila.querySelector(".total").value;
        datos.push({
          Producto: producto,
          "Unidades por caja": cajas,
          "Unidades sueltas": sueltas,
          "Total unidades": total
        });
      });
      return datos;
    }

    function enviarWhatsApp() {
      const responsable = document.getElementById("responsable").value || "No indicado";
      const fecha = document.getElementById("fecha").value || new Date().toLocaleDateString("es-CL");
      const datos = obtenerDatos();

      let mensaje = `Inventario Lotus Flower\nFecha: ${fecha}\nResponsable: ${responsable}\n\n`;

      datos.forEach(d => {
        if (parseInt(d["Total unidades"]) > 0) {
          mensaje += `• ${d.Producto}: ${d["Total unidades"]}\n`;
        }
      });

      const numero = "56920449772";
      const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensaje)}`;
      window.open(url, "_blank");
    }

    function generarExcel() {
      const responsable = document.getElementById("responsable").value || "No indicado";
      const fecha = document.getElementById("fecha").value || new Date().toLocaleDateString("es-CL");
      const datos = obtenerDatos();

      const hoja = XLSX.utils.json_to_sheet([]);
      XLSX.utils.sheet_add_aoa(hoja, [["Inventario Lotus Flower"]], { origin: "A1" });
      XLSX.utils.sheet_add_aoa(hoja, [[`Fecha: ${fecha}`]], { origin: "A2" });
      XLSX.utils.sheet_add_aoa(hoja, [[`Responsable: ${responsable}`]], { origin: "A3" });
      XLSX.utils.sheet_add_json(hoja, datos, { origin: "A5", skipHeader: false });

      const libro = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(libro, hoja, "Inventario");

      const nombreArchivo = `Inventario_LotusFlower_${fecha}_${responsable.replace(/\s+/g, "_")}.xlsx`;
      XLSX.writeFile(libro, nombreArchivo);
    }

    window.onload = function () {
      Object.entries(zonas).forEach(([zona, productos]) => crearTabla(zona, productos));
      document.getElementById("fecha").valueAsDate = new Date();

      document.getElementById("formularioInventario").addEventListener("input", actualizarTotales);
    };
  </script>

</body>
</html>
