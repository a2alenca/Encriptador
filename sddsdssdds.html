<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inventario R√°pido Bar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      margin: 10px;
      background: #f2f2f2;
    }
    h2 {
      text-align: center;
      color: #222;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: center;
      font-size: 14px;
    }
    th {
      background-color: #2a9d8f;
      color: white;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .separador {
      background-color: #264653;
      color: #fff;
      font-weight: bold;
      text-align: left;
      padding: 6px;
    }
    input, select {
      width: 100%;
      padding: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    button {
      padding: 12px;
      width: 100%;
      margin-top: 12px;
      background-color: #2a9d8f;
      border: none;
      color: white;
      font-weight: bold;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #21867a;
    }
    #inventarioResumen {
      white-space: pre-line;
      background: #fff;
      padding: 10px;
      margin-top: 15px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <h2>Inventario R√°pido del Bar</h2>

  <div style="overflow-x: auto;">
    <table id="tablaProductos">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Cajas</th>
          <th>Tipo Caja</th>
          <th>Sueltas</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="tablaBody">
        <!-- JS insertar√° aqu√≠ -->
      </tbody>
    </table>
  </div>

  <button onclick="generarResumen()">üìã Generar Inventario</button>
  <div id="inventarioResumen"></div>
  <button onclick="enviarWhatsApp()">üì≤ Enviar por WhatsApp</button>
  <button onclick="exportarExcel()">‚¨áÔ∏è Exportar a Excel</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    const zonas = {
      "Bebidas": ["Coca Cola", "Fanta", "Sprite"],
      "Abarrotes": ["Az√∫car", "Sal"],
      "Cervezas": ["Corona", "Heineken"],
      "Art√≠culos de Aseo": ["Cloro", "Detergente"],
      "Pulpas de Jugos": ["Pulpa de Mango", "Pulpa de Pi√±a"],
      "Cabernet Sauvignon": ["Cabernet Sauvignon"],
      "Carmenere": ["Carmenere"],
      "Merlot": ["Merlot"],
      "Sauvignon Blanc": ["Sauvignon Blanc"],
      "Chardonnay": ["Chardonnay"],
      "Espumante": ["Espumante Brut", "Espumante Dulce"],
      "Destilados": ["Whisky", "Vodka", "Ron", "Gin"],
      "Bajativos": ["Amaretto", "Baileys", "Fernet", "Licor de Menta"]
    };

    const tiposCaja = [1, 4, 6, 8, 12, 14, 15, 18, 24];
    const productos = [];

    window.onload = () => {
      const tbody = document.getElementById("tablaBody");
      let index = 0;

      for (let zona in zonas) {
        const separador = document.createElement("tr");
        separador.innerHTML = `<td class="separador" colspan="5">üóÇÔ∏è ${zona}</td>`;
        tbody.appendChild(separador);

        zonas[zona].forEach(producto => {
          productos.push(producto);
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${producto}</td>
            <td><input type="number" id="cajas-${index}" value="0" min="0" onchange="actualizarTotal(${index})"></td>
            <td>
              <select id="tipoCaja-${index}" onchange="actualizarTotal(${index})">
                ${tiposCaja.map(n => `<option value="${n}">${n === 1 ? "Sin caja" : "Caja de " + n}</option>`).join('')}
              </select>
            </td>
            <td><input type="number" id="sueltas-${index}" value="0" min="0" onchange="actualizarTotal(${index})"></td>
            <td><span id="total-${index}">0</span></td>
          `;
          tbody.appendChild(row);
          index++;
        });
      }
    };

    function actualizarTotal(i) {
      const cajas = parseInt(document.getElementById(`cajas-${i}`).value) || 0;
      const tipoCaja = parseInt(document.getElementById(`tipoCaja-${i}`).value) || 1;
      const sueltas = parseInt(document.getElementById(`sueltas-${i}`).value) || 0;
      const total = cajas * tipoCaja + sueltas;
      document.getElementById(`total-${i}`).innerText = total;
    }

    function generarResumen() {
      let resumen = "";
      let zonaAnterior = "";  // Variable para almacenar la zona y evitar repeticiones

      productos.forEach((nombre, i) => {
        const cajas = parseInt(document.getElementById(`cajas-${i}`).value) || 0;
        const tipoCaja = parseInt(document.getElementById(`tipoCaja-${i}`).value) || 1;
        const sueltas = parseInt(document.getElementById(`sueltas-${i}`).value) || 0;
        const total = cajas * tipoCaja + sueltas;
        let zona = "";  // Variable para almacenar la zona del producto

        // Determinar a qu√© zona pertenece el producto
        for (let z in zonas) {
          if (zonas[z].includes(nombre)) {
            zona = z;
            break;
          }
        }

        // Solo agregar productos con stock mayor que 0
        if (total > 0) {
          // Si la zona cambia, agregarla como encabezado
          if (zona !== zonaAnterior) {
            resumen += `\nüóÇÔ∏è ${zona}:\n`;
            zonaAnterior = zona;
          }

          // Formato en una sola l√≠nea por producto
          resumen += `  - ${nombre}: ${cajas} cajas (x${tipoCaja}), ${sueltas} sueltas, Total: ${total}\n`;
        }
      });

      document.getElementById("inventarioResumen").innerText = resumen || "No hay productos con stock.";
    }

    function enviarWhatsApp() {
      const mensaje = document.getElementById("inventarioResumen").innerText;
      if (!mensaje.trim()) {
        alert("Primero genera el inventario.");
        return;
      }
      const numero = "56920449772";
      const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensaje)}`;
      window.open(url, "_blank");
    }

    function exportarExcel() {
      const datos = [["Producto", "Cajas", "Tipo Caja", "Sueltas", "Total"]];
      productos.forEach((nombre, i) => {
        const cajas = parseInt(document.getElementById(`cajas-${i}`).value) || 0;
        const tipoCaja = parseInt(document.getElementById(`tipoCaja-${i}`).value) || 1;
        const sueltas = parseInt(document.getElementById(`sueltas-${i}`).value) || 0;
        const total = cajas * tipoCaja + sueltas;
        if (total > 0) {
          datos.push([nombre, cajas, tipoCaja, sueltas, total]);
        }
      });

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(datos);
      XLSX.utils.book_append_sheet(wb, ws, "Inventario");
      XLSX.writeFile(wb, "inventario_bar.xlsx");
    }
  </script>

</body>
</html>
